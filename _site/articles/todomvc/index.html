<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Swarm.js+React — real-time, offline-ready Holy Grail web apps &#8211; Swarm</title>
<meta name="description" content="reactive data sync middleware">
<meta name="keywords" content="">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="//swarmdb.net/images/site-logo.png">
<meta name="twitter:title" content="Swarm.js+React — real-time, offline-ready Holy Grail web apps">
<meta name="twitter:description" content="reactive data sync middleware">
<meta name="twitter:creator" content="@swarmsync">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Swarm.js+React — real-time, offline-ready Holy Grail web apps">
<meta property="og:description" content="reactive data sync middleware">
<meta property="og:url" content="//swarmdb.net/articles/todomvc/">
<meta property="og:site_name" content="Swarm">





<link rel="canonical" href="//swarmdb.net/articles/todomvc/">
<link href="//swarmdb.net/feed.xml" type="application/atom+xml" rel="alternate" title="Swarm Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="//swarmdb.net/assets/css/main.min.css">
<!-- Webfonts -->
<script src="//use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="//swarmdb.net/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="//swarmdb.net/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="//swarmdb.net/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="//swarmdb.net/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="//swarmdb.net/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="//swarmdb.net/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="//swarmdb.net/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
	        
			<li>
				
					<a href="//swarmdb.net/about/">About</a>
				 
			</li>
	        
			<li>
				
					<a href="//swarmdb.net/articles/">Articles</a>
				 
			</li>
	        
			<li>
				
					<a href="https://olebedev.github.io/mice">Demo</a>
				 
			</li>
	        
			<li>
				
					<a href="http://github.com/gritzko/swarm">GitHub</a>
				 
			</li>
	        
	        <li><a href="//swarmdb.net/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
	        <li class="dosearch"><i class="icon-search"></i> Search</li>
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<div class="search-wrapper">
	<div class="search-form">
		<input type="text" class="search-field" placeholder="Search...">
		<i class="icon-remove-sign icon-2x"></i>
		<ul class="search-results post-list"></ul><!-- /.search-results -->
	</div><!-- /.search-form -->
</div><!-- ./search-wrapper -->

<header class="masthead">
	<div class="wrap">
        
    		<a href="//swarmdb.net/" class="site-logo" rel="home" title="Swarm"><img src="//swarmdb.net/images/site-logo.png" width="200" height="200" alt="Swarm logo" class="animated fadeInUp"></a>
        
        <h1 class="site-title animated fadeIn"><a href="//swarmdb.net/">Swarm</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">reactive data sync middleware</h2>
	</div>
</header><!-- /.masthead -->


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <span class="entry-tags"></span>
        
          <h1 class="entry-title">Swarm.js+React — real-time, offline-ready Holy Grail web apps</h1>
        
      </header>
      <footer class="entry-meta">
        <img src="//swarmdb.net/images/selfie.jpg" alt="Victor Grishchenko photo" class="author-photo">
        <span class="author vcard">By <span class="fn"><a href="//swarmdb.net/about/" title="About Victor Grishchenko">Victor Grishchenko</a></span></span>
        <span class="entry-date date published"><time datetime="2014-10-14T00:00:00-04:00"><i class="icon-calendar-empty"></i> October 14, 2014</time></span>
        <span class="entry-date date modified"><time datetime="2014-10-14"><i class="icon-pencil"></i> October 14, 2014</time></span>
        <span class="entry-comments"><i class="icon-comment-alt"></i> <a href="#disqus_thread">Comment</a></span>
        <span><a href="//swarmdb.net/articles/todomvc/" rel="bookmark" title="Swarm.js+React — real-time, offline-ready Holy Grail web apps"><i class="icon-link"></i> Permalink</a></span>
        
        <span class="social-share-facebook">
            <a href="https://www.facebook.com/sharer/sharer.php?u=//swarmdb.net/articles/todomvc/" title="Share on Facebook" itemprop="Facebook"><i class="icon-facebook-sign"></i> Like</a></span>
        <span class="social-share-twitter">
            <a href="https://twitter.com/intent/tweet?hashtags=articles&text=Swarm.js+React — real-time, offline-ready Holy Grail web apps&url=//swarmdb.net/articles/todomvc/&via=swarmsync" title="Share on Twitter" itemprop="Twitter"><i class="icon-twitter-sign"></i> Tweet</a></span>
        <span class="social-share-googleplus">
            <a href="https://plus.google.com/share?url=//swarmdb.net/articles/todomvc/" title="Share on Google Plus" itemprop="GooglePlus"><i class="icon-google-plus-sign"></i> +1</a></span>
            <!-- /.social-share -->
      </footer>
      <div class="entry-content">
        <p>The state of sync in web apps is that <em>sync sucks</em>.
GTalk loses messages inbetween desktop and mobile.
Apple iCloud can’t merge back document replicas if those were edited concurrently.
Google Docs needs some ungodly chemistry to resync after working offline.
These are SNAFUs I personally experienced and I have also heard other folks complaining about <a href="https://news.ycombinator.com/item?id=7009995">Evernote</a>, Skype, <a href="https://news.ycombinator.com/item?id=8440985">Dropbox</a>, you name it.</p>

<p><img src="//swarmdb.net/images/syncsucks.png" alt="Sync sucks" /></p>

<p>Skipping collaborative apps, these days even a single user needs to sync his/her devices (see <a href="https://www.apple.com/ios/whats-new/continuity/">continuity</a>).
The device landscape is getting predominantly mobile, so an average user has multiple powerful devices with unreliable internet connections.</p>

<p>Popular solutions suck for one simple reason: common sense fails us in distributed systems.
Proper sync needs some math like a GPS device needs some relativity formulas.
Yes, that is just a box that says your <em>x</em> and <em>y</em>.
No, it can’t work by common sense alone; it needs math.</p>

<p>In 2013, we released the <a href="http://dailyjs.com/2013/05/06/swarm-dookie-angularjs-book/">0.1 version</a> of Swarm, which was, basically, some slap-together per-column <a href="http://basho.com/tag/last-write-wins/">last-write-wins</a> solution, like <a href="http://firebase.com">Firebase</a> and <a href="http://www.datastax.com/dev/blog/why-cassandra-doesnt-need-vector-clocks">many others</a> are using.
We already had the experience of implementing a <a href="http://letters.yandex.ru">real-time collaborative editor</a> and we knew that LWW was not enough.
So we reimplemented Swarm from scratch (twice) to have proper op-based <a href="http://kellabyte.com/2013/05/20/convergent-replicated-data-types/">CRDT</a> as its base.</p>

<p>The result was like magic.</p>

<h2 id="todomvc-real-time--offline-the-holiest-grail">TodoMVC: real-time + offline, the holiest grail</h2>

<p>Switching from theory to practice, we decided to approach the standard <a href="http://todomvc.com/">TodoMVC</a> app a bit more creatively to showcase all the interesting capabilities.
Actually, the <a href="https://github.com/andreypopp/todomvc-flux-swarm">first Swarm+React TodoMVC</a> was created by Andrey Popp on 15 July 2014, but that one was not <em>idiomatic</em>.
The <a href="http://ppyr.us">new demo</a> can:</p>

<ul>
  <li>synchronize in real-time (WebSocket),</li>
  <li>cache data at the client (WebStorage),</li>
  <li>load and work completely offline (Application Cache).</li>
</ul>

<p>Importantly, it employs a linear CRDT collection (Vector).
That is different from both Swarm v0.1 and the July demo which used a set-sorting hack to make collections sort-of linear (same as Firebase).
That is particularly important because serious approach to collaborative editing requires advanced linear collections (text is linear).</p>

<iframe src="http://ppyr.us" width="640" height="400" onload="window.scrollTo(0,0)"></iframe>

<p>The app employs <a href="https://github.com/gritzko/todomvc-swarm/tree/master/model">Swarm models</a> and <a href="https://github.com/gritzko/todomvc-swarm/tree/master/view">React views</a>.
It is important to notice that the code is written like it is a local <a href="http://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller">MVC</a> app.
The only network-aware call in client-side code is <em>connect()</em> which “plugs” the model into the server’s sync “outlet”.
Later on, all the sync is done by Swarm in the background; update events are delivered to views using the popular <em>on()/off()</em> subscription pattern, and even that is hidden inside <a href="https://github.com/gritzko/swarm/blob/master/lib/ReactMixin.js">ReactMixin</a>.</p>

<script src="https://gist.github.com/gritzko/b6a06d27627f37386c9d.js"></script>

<p>The app is optimized for instant load using the <a href="http://www.slideshare.net/spikebrehm/2014-0313fluent">Holy Grail</a> approach.
All the views, models and even the <a href="https://github.com/gritzko/todomvc-swarm/blob/master/todoRouter.js">router</a> are shared between client and server.
The server-side code prerenders React views so the browser gets static HTML (fast).
The page is made live once scripts and data arrive (slower).
Holy Grail is critical, considering that React.js is rather heavy.
The resulting page load latency is quite close to <a href="http://en.wikipedia.org/wiki/Round-trip_delay_time">RTT</a>.</p>

<p><img src="//swarmdb.net/images/timeline.png" alt="Page load timeline" /></p>

<p>Another interesting part is offline work.
Swarm is able of caching all the data in the browser’s local storage.
Thanks to CRDT merge features, the app may work offline and synchronize to the server on reconnect.
That relieves the developer from the necessity to workaround temporary network failures.
Swarm syncs the entire chain of replicas: back-end storage to server-side objects to client-side objects to browser storage.
Every step of that chain may fail - because of server restarts, intermittent connections or simply a user closing his/her laptop.
All such interruptions are solved by the unified syncing protocol that re-syncs data on re-connection.
Just for comparison, <a href="https://meteorhacks.com/introduction-to-ddp.html">Meteor’s DDP</a> lacks such versioning/resync features, which fact essentially turned it into yet-another rediscovery of <a href="http://en.wikipedia.org/wiki/Remote_procedure_call">RPC API</a>.</p>

<p>Thanks to HTML5 Application Cache, the app essentially installs itself into the browser, so you may load and run it entirely offline.
Thanks to CRDT, it can always resync later.
Actually, it is often hard to tell whether the app is online or not.
That provides some native-like app experience, except maybe for the fps aspect.</p>

<p>One more fine detail that is easy to miss.
The app is able to sync by multiple channels at once. While other users and browsers are synced through the server, browser tabs sync by <a href="http://www.w3.org/TR/webstorage/#the-storage-event">WebStorage events</a>.</p>

<p>To explore the app’s collaborative features, please send the exact page link to your friend or open it in another browser.</p>

<h2 id="what-is-the-big-picture">What is the big picture?</h2>

<p>Essentially, Swarm is a data event bus shared between client and server.
We think that such a data/event bus will become a standard component of the stack, very much like a database is today.
Such a bus does a great deal of work to overcome friction in distributed systems, especially as the client becomes a full-featured part of it.
Our idea is not entirely new; see e.g. <a href="http://kafka.apache.org/">Apache Kafka</a>.
The new part is to extend that bus to the client using CRDT.</p>

<p><img src="//swarmdb.net/images/swarm-moscowjs-deployment.png" alt="Swarm: deployment" /></p>

<p>I remember the times when my fellow developers were leery of the <a href="http://www.hanselman.com/blog/CVSAndSubversionVsVSSSourceSafe.aspx">CVS optimistic model</a>. Back then, relativism of git was entirely unthinkable.
On hearing of CRDTs, folks often ask about ACID which, most likely, they <a href="http://t.co/KGkIlLOPtU">don’t actually need</a>.
We believe that real-time sync middleware will have a transformative effect on the domain of web/mobile app development.
That effect would be comparable to the one TCP had on internetworking, <a href="http://www.worldshipping.org/about-the-industry/history-of-containerization">containerization</a> had on international logistics or git on version control systems.
To arrive at the destination, we need to solve many difficult issues, like access control (more on that later) and reasonable consistency guarantees.</p>

<p>Once you have this kind of platform-level sync, features of user collaboration and continuity come virtually for free and server-side scaling becomes easy and robust.</p>

<p>So, feel free to play with the app, check it out on <a href="https://github.com/gritzko/todomvc-swarm">GitHub</a>, try <a href="http://github.com/gritzko/swarm">the lib</a> and subscribe to our <a href="http://twitter.com/swarm_js">twitter account</a>.</p>


        <div id="disqus_thread"></div><!-- /#disqus_thread -->
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="//swarmdb.net/articles/objects-are-event-streams/" class="btn" title="An object as an event stream">Previous article</a>
      
      
        <a href="//swarmdb.net/articles/1of5/" class="btn" title="Swarm v 0.4 intro (1/5)">Next article</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2018 Victor Grishchenko. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/so-simple/">So Simple Theme</a>.</span>
<div class="social-icons">
	<a href="http://twitter.com/swarmsync" title="Victor Grishchenko on Twitter" target="_blank"><i class="icon-twitter icon-2x"></i></a>
	
	
	
	
	
	
	<a href="http://github.com/swarmdb" title="Victor Grishchenko on Github" target="_blank"><i class="icon-github icon-2x"></i></a>
	
</div><!-- /.social-icons -->
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="//swarmdb.net/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="//swarmdb.net/assets/js/scripts.min.js"></script>

<!-- Jekyll Simple Search option -->
<script>
  $(document).ready(function() {
      $('.search-field').simpleJekyllSearch({
          jsonFile : '//swarmdb.net/search.json',
          searchResults : '.search-results',
          template : '<li><article><a href="{url}">{title} <span class="entry-date"><time datetime="{date}">{shortdate}</time></span></a></article></li>',
          noResults: '<p>Nothing found.</p>'
        });
  });

  (function( $, window, undefined ) {
    
     var bs = {
          close: $(".icon-remove-sign"),
          searchform: $(".search-form"),
          canvas: $("body"),
          dothis: $('.dosearch')
      };
    
    bs.dothis.on('click', function() {
      $('.search-wrapper').css({ display: "block" });
      bs.searchform.toggleClass('active');
      bs.searchform.find('input').focus();
      bs.canvas.toggleClass('search-overlay');
    });
    
      bs.close.on('click', function() {
        $('.search-wrapper').removeAttr( 'style' );
        bs.searchform.toggleClass('active');
        bs.canvas.removeClass('search-overlay');
    });
  })( jQuery, window );
</script>


<!-- Asynchronous Google Analytics snippet -->
<script>
//   var _gaq = _gaq || [];
//   var pluginUrl = 
//  '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
//   _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
//   _gaq.push(['_setAccount', 'UA-46399542-5']);
//   _gaq.push(['_trackPageview']);
//
//   (function() {
//     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
//     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
//     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
//   })();
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46399542-5', 'auto');
  ga('send', 'pageview');
</script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'swarmjs'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	        

</body>
</html>
