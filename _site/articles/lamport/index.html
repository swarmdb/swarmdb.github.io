<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Swarm/Lamport timestamps &#8211; Swarm</title>
<meta name="description" content="reactive data sync middleware">
<meta name="keywords" content="">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="//swarmdb.net/images/teaparty.jpg">

<meta name="twitter:title" content="Swarm/Lamport timestamps">
<meta name="twitter:description" content="reactive data sync middleware">
<meta name="twitter:creator" content="@swarmsync">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Swarm/Lamport timestamps">
<meta property="og:description" content="reactive data sync middleware">
<meta property="og:url" content="//swarmdb.net/articles/lamport/">
<meta property="og:site_name" content="Swarm">





<link rel="canonical" href="//swarmdb.net/articles/lamport/">
<link href="//swarmdb.net/feed.xml" type="application/atom+xml" rel="alternate" title="Swarm Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="//swarmdb.net/assets/css/main.min.css">
<!-- Webfonts -->
<script src="//use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="//swarmdb.net/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="//swarmdb.net/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="//swarmdb.net/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="//swarmdb.net/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="//swarmdb.net/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="//swarmdb.net/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="//swarmdb.net/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
	        
			<li>
				
					<a href="//swarmdb.net/about/">About</a>
				 
			</li>
	        
			<li>
				
					<a href="//swarmdb.net/articles/">Articles</a>
				 
			</li>
	        
			<li>
				
					<a href="https://olebedev.github.io/mice">Demo</a>
				 
			</li>
	        
			<li>
				
					<a href="http://github.com/gritzko/swarm">GitHub</a>
				 
			</li>
	        
	        <li><a href="//swarmdb.net/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
	        <li class="dosearch"><i class="icon-search"></i> Search</li>
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<div class="search-wrapper">
	<div class="search-form">
		<input type="text" class="search-field" placeholder="Search...">
		<i class="icon-remove-sign icon-2x"></i>
		<ul class="search-results post-list"></ul><!-- /.search-results -->
	</div><!-- /.search-form -->
</div><!-- ./search-wrapper -->

<header class="masthead">
	
		<div class="wrap">
			<a href="//swarmdb.net/" class="site-logo" rel="home" title="Swarm"><img src="//swarmdb.net/images/site-logo.png" width="200" height="200" alt="Swarm logo" class="animated bounceInDown"></a>
		</div>
	
</header><!-- /.masthead -->



<div id="main" role="main">
  <article class="hentry">
    <img src="//swarmdb.net/images/teaparty.jpg" class="entry-feature-image" alt="Swarm/Lamport timestamps" >
    <div class="entry-wrapper">
      <header class="entry-header">
        <span class="entry-tags"></span>
        
          <h1 class="entry-title">Swarm/Lamport timestamps</h1>
        
      </header>
      <footer class="entry-meta">
        <img src="//swarmdb.net/images/selfie.jpg" alt="Victor Grishchenko photo" class="author-photo">
        <span class="author vcard">By <span class="fn"><a href="//swarmdb.net/about/" title="About Victor Grishchenko">Victor Grishchenko</a></span></span>
        <span class="entry-date date published"><time datetime="2014-07-15T00:00:00-04:00"><i class="icon-calendar-empty"></i> July 15, 2014</time></span>
        <span class="entry-date date modified"><time datetime="2015-09-17"><i class="icon-pencil"></i> September 17, 2015</time></span>
        <span class="entry-comments"><i class="icon-comment-alt"></i> <a href="#disqus_thread">Comment</a></span>
        <span><a href="//swarmdb.net/articles/lamport/" rel="bookmark" title="Swarm/Lamport timestamps"><i class="icon-link"></i> Permalink</a></span>
        
        <span class="social-share-facebook">
            <a href="https://www.facebook.com/sharer/sharer.php?u=//swarmdb.net/articles/lamport/" title="Share on Facebook" itemprop="Facebook"><i class="icon-facebook-sign"></i> Like</a></span>
        <span class="social-share-twitter">
            <a href="https://twitter.com/intent/tweet?hashtags=articles&text=Swarm/Lamport timestamps&url=//swarmdb.net/articles/lamport/&via=swarmsync" title="Share on Twitter" itemprop="Twitter"><i class="icon-twitter-sign"></i> Tweet</a></span>
        <span class="social-share-googleplus">
            <a href="https://plus.google.com/share?url=//swarmdb.net/articles/lamport/" title="Share on Google Plus" itemprop="GooglePlus"><i class="icon-google-plus-sign"></i> +1</a></span>
            <!-- /.social-share -->
      </footer>
      <div class="entry-content">
        <p><a href="http://en.wikipedia.org/wiki/Lamport_timestamps">Lamport timestamps</a> are necessary to sort out event order and causality
issues in a distributed system.  The original <a href="http://research.microsoft.com/en-us/um/people/lamport/pubs/time-clocks.pdf">article</a> defines
Lamport clocks as, essentially, a tuple of a number (plain timestamp) and a
process id.  Each process stamps its new event with a number, assuming it is
greater than any previously known timestamp number.  Concurrent events created
by different processes may have equal timestamp numbers.  Such tie is resolved
in an arbitrary but consistent way, namely by comparing (unique) process ids.</p>

<p><img src="//swarmdb.net/images/cite-lamport.png" alt="Lamport: total order definition" /></p>

<p>Timing of an event may turn equally useful from the end-user perspective
(remember that “1m”, “2h” grey labels on Twitter, for example). But, using the
same timestamp both ways (for causal and wall clock time) is actually quite
tricky.  On one hand, computer clocks tend to be less precise than necessary,
especially considering that events propagate by the network with the speed of
light. That is especially true for end-user computer clock which may be off by
an hour. On the other hand, logical Lamport time is generally not supposed to
reflect wall clock time at all; “logical timestamps” means “counters” in most
of the cases.</p>

<p>The rich man approach to the problem is to install atomic clocks and satellite
receivers to datacenters so machine time is very precise.  Then, computer
clocks become somewhat useful for handling causality/order issues (see Google
Spanner).</p>

<p>Swarm is an operation-based CRDT engine where every event is marked with a
Lamport timestamp.  In our past projects we used Lamport timestamps literally
defined as a pair of integers. That approach was not good enough for the
general case, so finally we settled on the following scheme:</p>

<p><img src="//swarmdb.net/images/spec.png" alt="Swarm specifiers (compound event identifiers)" /></p>

<p>The Lamport timestamp is <code>!8V7N809+Walt~ssn</code>. Both parts of the timestamp are
different from the “literal” scheme.  First, the “number” component is an
actual <a href="https://github.com/gritzko/swarm/blob/master/lib/SecondPreciseClock.js#L61">timestamp in base64</a>. <code>8V7N8</code> is 142374344 seconds since 1 Jan
2010, while <code>09</code> is a sequence number used to create multiple events a second.
Second, the “process id” is a combination of a user id (like <code>Walt</code>) and a
session id (like <code>ssn</code>).  It is an extremely useful feature to see the author
of an event straight from the event id.  Session id is needed to denote
different sessions of the same user (like Chrome on a home PC and Safari on a
laptop).  While sessions share same data and same credentials, in terms of the
Lamport model they are concurrent processes generating independent events.
These compound timestamps can be compared lexicographically, have all the
necessary logical timestamp features and (tadaam) provide basic information on
the event, such as wall clock time and the author id.</p>

<p>That scheme assumes some level of clock synchronization between replicas.
Practically, web clients with bad clocks must coordinate with their server
to stay reasonably correct.</p>

<p>Swarm implements two other timestamp schemes: purely logical LamportClocks
and MinutePreciseClocks if you do not care about seconds.
It is up to the developer to pick the most convenient one.</p>

<p>I hope, that explains that slightly unfamiliar look of Lamport timestamps in Swarm.</p>


        <div id="disqus_thread"></div><!-- /#disqus_thread -->
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="//swarmdb.net/articles/release/" class="btn" title="Swarm 0.3 is released">Previous article</a>
      
      
        <a href="//swarmdb.net/articles/moscowjs/" class="btn" title="MoscowJS slides">Next article</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2018 Victor Grishchenko. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/so-simple/">So Simple Theme</a>.</span>
<div class="social-icons">
	<a href="http://twitter.com/swarmsync" title="Victor Grishchenko on Twitter" target="_blank"><i class="icon-twitter icon-2x"></i></a>
	
	
	
	
	
	
	<a href="http://github.com/swarmdb" title="Victor Grishchenko on Github" target="_blank"><i class="icon-github icon-2x"></i></a>
	
</div><!-- /.social-icons -->
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="//swarmdb.net/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="//swarmdb.net/assets/js/scripts.min.js"></script>

<!-- Jekyll Simple Search option -->
<script>
  $(document).ready(function() {
      $('.search-field').simpleJekyllSearch({
          jsonFile : '//swarmdb.net/search.json',
          searchResults : '.search-results',
          template : '<li><article><a href="{url}">{title} <span class="entry-date"><time datetime="{date}">{shortdate}</time></span></a></article></li>',
          noResults: '<p>Nothing found.</p>'
        });
  });

  (function( $, window, undefined ) {
    
     var bs = {
          close: $(".icon-remove-sign"),
          searchform: $(".search-form"),
          canvas: $("body"),
          dothis: $('.dosearch')
      };
    
    bs.dothis.on('click', function() {
      $('.search-wrapper').css({ display: "block" });
      bs.searchform.toggleClass('active');
      bs.searchform.find('input').focus();
      bs.canvas.toggleClass('search-overlay');
    });
    
      bs.close.on('click', function() {
        $('.search-wrapper').removeAttr( 'style' );
        bs.searchform.toggleClass('active');
        bs.canvas.removeClass('search-overlay');
    });
  })( jQuery, window );
</script>


<!-- Asynchronous Google Analytics snippet -->
<script>
//   var _gaq = _gaq || [];
//   var pluginUrl = 
//  '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
//   _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
//   _gaq.push(['_setAccount', 'UA-46399542-5']);
//   _gaq.push(['_trackPageview']);
//
//   (function() {
//     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
//     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
//     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
//   })();
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46399542-5', 'auto');
  ga('send', 'pageview');
</script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'swarmjs'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	        

</body>
</html>
